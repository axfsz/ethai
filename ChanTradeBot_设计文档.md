
# 📘 产品设计文档（PDD）
## 名称：ChanTradeBot – 缠论智能策略通知机器人

---

## 一、产品定位

ChanTradeBot 是一款融合缠论结构识别、指标信号分析和策略生成通知于一体的智能交易辅助系统。  
其核心功能是：**基于市场实时K线数据，自动识别交易信号，计算策略盈亏比，按需生成普通/重仓策略，并通过 Telegram 实时推送交易建议**。

---

## 二、核心功能

| 模块 | 功能说明 |
|------|----------|
| ⛓ 数据模块 | 实时获取多周期 K 线数据（1H/4H/1D/1W） |
| 📐 缠论结构引擎 | 自动识别笔、段、中枢、走势类型、背驰（基于k.md） |
| 🔍 信号识别器 | 检测多类交易信号（来自 xinhao.md） |
| ⚙ 策略生成器 | 根据信号数量与等级自动生成策略单 |
| 📊 盈亏比分析器 | 自动测算止盈止损点，确保 ≥ 3:1 |
| 🧠 仓位建议模块 | 按信号强度/黄金法则评估持仓比例 |
| 📬 通知推送系统 | 使用 Telegram Bot 推送策略建议 |
| 🌐 接口服务 | 提供 HTTP API 接口供外部触发与集成调用 |

---

## 三、策略生成逻辑

### 🎯 策略分类

| 类型 | 触发条件 | 仓位建议 | 策略周期 |
|------|----------|----------|-----------|
| 短线试探单 | 只触发 1 个强信号 | 1%~2% | 1小时~1日 |
| 轻仓策略单 | 2 个有效信号 | 3%~5% | 4小时~3日 |
| 重仓策略单 | ≥3 个高质量信号且符合“黄金法则” | 5%~8% | 日线~周线 |
| 空仓观望 | 无明显信号 | 0% | N/A |

### 🧠 黄金法则（重仓策略判定）

重仓单需满足：

- 至少 3 个信号共振：
  - 技术指标信号（如 MACD 金叉）
  - K线结构（如突破中枢上沿）
  - 成交量信号（如放量突破）
- 策略盈亏比 ≥ 3:1
- 缠论结构中处于主升段、3买或段中枢上沿

---

## 四、缠论结构模块（来自 `k.md`）

- 笔：以三根K线构建
- 段：由至少两笔组成
- 中枢：三个以上重叠的段构成中枢
- 趋势判断：依托“是否延伸中枢”
- 背驰判定：用于止盈或反转
- 区间套判定：用以确定买卖点位： 第一、第二、第三 买点 以及合适的卖点。
---

## 五、信号识别模块（来自 `xinhao.md`）

### ✅ 可识别信号示例：

| 周期 | 信号类型 | 检测方式 |
|------|----------|-----------|
| 周线 | EMA20 上升 | 趋势确认 |
| 日线 | RSI 底背离 | 动量背离 |
| 4H | 布林带上穿 + 放量 | 多头突破 |
| 1H | MACD 金叉 | 快速入场信号 |

---

## 六、盈亏比评估与仓位管理

```python
盈亏比 = (止盈价 - 入场价) / (入场价 - 止损价)
```

系统会动态测算策略中的盈亏比，若 `< 3:1` 则不予推送；同时，信号强度决定建议仓位。

---

## 七、通知系统设计（参考 `strategy_notifier.py`）

### ✅ 通知渠道：Telegram Bot  
- 多群组支持（支持多个 `chat_id`）  
- HTML 格式化推送  
- 延迟处理保护，支持 `timeout` 设置  

### ✅ 通知格式模板（示例）：

```
📊 ETH 策略预测
--------------------------
⚡ 检测信号: 周线EMA上升, 日线RSI底背离, 4小时放量突破
💡 仓位建议: 重仓建议 (5%-8%)
==========================
免责声明：以上为AI策略预测，不构成投资建议。
⏰ 生成时间: 2025-06-25 14:30 (北京时间)
```

---

## 八、系统架构建议

```plaintext
            +------------------+
            |  K线数据服务     | ← Binance, OKX, etc.
            +--------+---------+
                     |
         +-----------v-----------+
         | 缠论分析引擎 (ChanCore)|
         +-----------+-----------+
                     |
         +-----------v-----------+
         | 信号判断器 (SignalBot)|
         +-----------+-----------+
                     |
         +-----------v-----------+
         | 策略生成器 (StratGen) |
         +-----------+-----------+
                     |
         +-----------v-----------+
         | Telegram 通知服务     |
         +-----------+-----------+
                     |
         +-----------v-----------+
         | Web 接口 (Flask API)  |
         +------------------------+
```

---

## 九、接口设计（参考 Flask）

| 路由 | 方法 | 说明 |
|------|------|------|
| `/predict_strategy` | POST | 触发信号检测 + 自动生成策略通知 |
| `/notify_order_strategy` | POST | 从表格读取策略挂单数据并发送通知 |
| `/notify_status` | POST | 当前无信号时推送观望建议 |
| `/test_notify` | POST | 发送一条测试策略消息 |

---

## 十、扩展与计划

| 功能 | 状态 | 说明 |
|------|------|------|
| 回测模块 | ⏳ 待实现 | 可模拟信号触发策略回测验证 |
| 多币种支持 | ✅ 支持 ETH，可扩展 BTC 等 |
| 多策略系统接入 | ✅ 支持 JSON/Excel 导入策略单 |
| 可视化分析图 | ⏳ 可集成 Plotly / TradingView 图 |
| 风控止损逻辑 | ✅ 按策略盈亏比自动设置 |

---

## ✅ 总结

ChanTradeBot 是一套以缠论分析为基础，结合多周期技术信号的自动化策略机器人。配合 `Telegram Bot`，能将高质量策略实时推送到群组或终端用户，提高交易判断力与执行效率。
